services:
  api:
    container_name: api_tunnel_tool
    build:
      context: ./backend
    network_mode: "${API_NETWORK_MODE:-host}"
    environment:
      DATA_DIR: "${DATA_DIR:-/data}"
      ALLOW_CIDRS: "${ALLOW_CIDRS:-127.0.0.1/32,::1/128,172.16.0.0/12}"
      CORS_ORIGINS: "${CORS_ORIGINS:-}"
      API_PORT: "${API_PORT:-3001}"
    volumes:
      - ./data:${DATA_DIR:-/data}
    restart: unless-stopped

  web:
    container_name: web_tunnel_tool
    build:
      context: ./frontend
    ports:
      - "${WEB_BIND_IP:-127.0.0.1}:${WEB_PORT:-8081}:80"
    extra_hosts:
      - "${WEB_EXTRA_HOST:-host.docker.internal:host-gateway}"
    environment:
      API_HOST: "${API_HOST:-host.docker.internal}"
      API_PORT: "${API_PORT:-3001}"
    depends_on:
      - api
    restart: unless-stopped
